<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Class Diagram with Mermaid</title>
    <script type="module">
        import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
        mermaid.initialize({ startOnLoad: false });
        window.mermaid = mermaid;
    </script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>

<h1>Class Diagram for Cabinet Medical</h1>
<div class="mermaid" id="classDiagram"></div>

<script>
const apiUrl = "https://api.github.com/repos/AnasHefied/Projet1_Thyp_Ahef/contents/data/rt"; // GitHub API URL for the JSON files
let mermaidText = "classDiagram\n";

// Fetch the list of JSON files from the GitHub repository
d3.json(apiUrl)
    .then(files => {
        // Filter out only JSON files
        const jsonFiles = files.filter(file => file.name.endsWith(".json"));
        
        // Fetch each JSON file content
        const filePromises = jsonFiles.map(file => d3.json(file.download_url));
        
        Promise.all(filePromises)
            .then(fileContents => {
                // Process each JSON file's content to generate class diagram notation
                fileContents.forEach(data => {
                    // Use `o:label` as the class name if available
                    const className = data['o:label'] || "UnnamedClass";
                    mermaidText += `class ${className} {\n`;

                    // Extract properties and add them as class attributes
                    const properties = data["o:resource_template_property"];
                    if (properties) {
                        properties.forEach(prop => {
                            const label = prop.label || "UnnamedProperty";
                            const localName = prop.local_name || "String";
                            const type = (localName === "cabinet_medical") ? "Boolean" : "String";
                            mermaidText += `    +${type} ${label}\n`;
                        });
                    }
                    mermaidText += "}\n";
                });

                // Insert the generated Mermaid code into the HTML container
                document.getElementById("classDiagram").innerHTML = mermaidText;
                
                // Initialize Mermaid to render the diagram
                mermaid.init(undefined, document.querySelectorAll(".mermaid"));
            })
            .catch(error => {
                console.error("Error retrieving data from JSON files:", error);
            });
    })
    .catch(error => {
        console.error("Error retrieving files from GitHub API:", error);
    });
</script>

</body>
</html>
